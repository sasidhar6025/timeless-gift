@import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@500;700&display=swap');

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: var(--bg, #f7f7f7);
  color: var(--text, #1a1a1a);
}

/* Import a small handwritten font for headings */

.container {
  max-width: 720px;
  margin: auto;
  padding: 40px 20px;
}

/* Favorites menu (top-right) */
.favorites-menu { display: flex; gap: 8px; align-items: center; }
.fav-btn { background: rgba(0,0,0,0.6); color: #fff; border: none; padding: 6px 10px; border-radius: 8px; cursor: pointer; }
.fav-list { position: fixed; top: 12px; right: 12px; background: var(--card); padding: 8px; border-radius: 8px; box-shadow: 0 8px 20px rgba(0,0,0,0.12); z-index: 11000; min-width: 220px; max-height: 60vh; overflow: auto; }
.fav-item { padding: 6px 8px; border-radius: 6px; cursor: pointer; }
.fav-item:hover { background: rgba(0,0,0,0.04); }
.fav-item.focused { background: rgba(0,0,0,0.08); }
.fav-block { position: relative; }

/* When HoverImage is used inside the fav-list, show image to the right */
.fav-list .hover-image { position: absolute; left: 100%; top: 0; margin-left: 8px; width: 160px; box-shadow: 0 8px 20px rgba(0,0,0,0.12); }

/* Center layout and prepare layering for persona background */
.app-root { display: grid; place-items: center; min-height: 100vh; position: relative; z-index: 0; isolation: isolate; }
.container.content { width: 100%; max-width: 920px; padding: 60px 28px; text-align: center; margin: 0 auto; }

/* Theme variables: warm (paper) and night are toggled via .theme-warm or .theme-night on <html> */
:root {
  --bg: #f7efe6;
  --card: #fffdf8;
  --text: #3d2b1f;
  --muted-text: #6b5a4b;
  --accent: #b86b1c;
  --persona-opacity: 0.10;
  --persona-blur: 12px;
  --persona-scale: 1.05;
  /* lighter overlay so background portrait remains visible */
  --content-overlay: rgba(255,255,255,0.28);
  /* earthy warm fallback gradient if persona image is not present */
  --earth-gradient: linear-gradient(90deg, #f7efe6 0%, #eed9c6 45%, #d6b59a 100%);
}

.theme-night {
  --bg: #0f1113;
  --card: #121212;
  --text: #e7e7e7;
  --muted-text: #a8a8a8;
  --accent: #ffd7a8;
  --persona-opacity: 0.06;
  --persona-blur: 22px;
  --persona-scale: 1.2;
  --content-overlay: rgba(8,8,8,0.28);
  --earth-gradient: linear-gradient(90deg, #0b0d0e 0%, #1b2224 45%, #2b2f31 100%);
}

.title {
  font-size: 24px;
  line-height: 1.4;
  margin-bottom: 30px;
}

.subtitle {
  opacity: 0.7;
  margin-bottom: 40px;
}

.card {
  background: var(--card, white);
  padding: 18px 20px;
  border-radius: 12px;
  margin: 18px auto; /* center cards */
  cursor: pointer;
  transition: transform 260ms ease, box-shadow 260ms ease, background 0.3s ease;
  max-width: 700px;
  box-shadow: 0 6px 18px rgba(37, 25, 18, 0.08);
}

.card-fold {
  position: absolute;
  right: 14px;
  top: 12px;
  width: 24px;
  height: 24px;
  background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(240,232,224,0.95));
  border-radius: 6px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.06);
  transform: rotate(12deg);
  pointer-events: none;
}
.card-title { font-weight: 600; font-size: 16px; }
.card:active { transform: scale(0.995); }
.card:hover { transform: translateY(-4px); box-shadow: 0 22px 46px rgba(28,20,12,0.14); }

/* high-contrast focus outlines for keyboard users */
.card:focus { outline: 3px solid rgba(184,107,28,0.18); box-shadow: 0 22px 46px rgba(28,20,12,0.14); }
.fav-btn:focus { outline: 3px solid rgba(184,107,28,0.18); }
button:focus { outline: 3px solid rgba(184,107,28,0.12); }

.card:hover {
  background: #f0f0f0;
}

.card, .title, .subtitle {
  color: var(--text);
}

.modal {
  position: fixed;
  inset: 0;
  /* dim background while keeping portrait visible */
  background: rgba(10,10,10,0.36);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}
.modal-content {
  /* modal content keeps message color via inline style, but ensure text uses theme variable */
  background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,244,238,0.98));
  padding: 28px 34px;
  max-width: 640px;
  border-radius: 18px;
  animation: cardOpen 420ms cubic-bezier(.2,.9,.28,1);
  box-shadow: 0 18px 40px rgba(28,20,12,0.18), 0 4px 12px rgba(28,20,12,0.06);
  color: var(--text);
  position: relative;
  z-index: 10001;
}

/* small greeting-card open state on the root when a message is opened */
.greeting-open .modal { background: linear-gradient(rgba(9,7,5,0.28), rgba(9,7,5,0.28)); }
.greeting-open .modal-content { transform: rotateX(0deg) translateY(0); border-top: 4px solid rgba(184,107,28,0.12); }

@keyframes cardOpen {
  from { opacity: 0; transform: translateY(18px) scale(0.985) rotateX(8deg); }
  to { opacity: 1; transform: translateY(0) scale(1) rotateX(0deg); }
}

/* page-turn animation: subtle 3D rotate + clip */
.greeting-open .modal-content {
  transform-origin: left center;
  animation: pageTurn 520ms cubic-bezier(.2,.9,.28,1);
}
@keyframes pageTurn {
  0% { transform: perspective(800px) rotateY(-14deg) translateX(-18px); opacity: 0.0; }
  60% { transform: perspective(800px) rotateY(6deg) translateX(0); opacity: 0.98; }
  100% { transform: perspective(800px) rotateY(0deg) translateX(0); opacity: 1; }
}

/* Handwritten title and signature styles */
.modal-content .card-title { font-family: 'Dancing Script', 'Georgia', serif; font-size: 28px; margin: 6px 0 12px; }
.modal-content .modal-body { font-family: 'Georgia', serif; line-height: 1.6; }
.modal-content .signature { margin-top: 18px; text-align: right; font-family: 'Dancing Script', Georgia, serif; font-size: 18px; color: rgba(61,43,31,0.86); }
.modal-content .opened-line { margin-top: 10px; font-size: 12px; color: var(--muted-text); opacity: 0.9; }

/* Savor mode: slower reveals and larger line spacing */
.savor-mode .savor-line { opacity: 0; transform: translateY(8px); transition: opacity 900ms ease, transform 900ms ease; margin-bottom: 18px; }
.savor-mode .savor-line.visible { opacity: 1; transform: translateY(0); }
.savor-mode .modal-body { line-height: 2.0; }
.savor-mode .modal-content { transition-duration: 900ms; }

/* night theme adjustments */
.theme-night .modal-content {
  background: rgba(20,20,20,0.9) !important;
  color: var(--text) !important;
}

.modal-close {
  position: absolute;
  right: 12px;
  top: 12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.92), rgba(240,232,224,0.94));
  color: var(--text);
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 20px;
  line-height: 1;
  box-shadow: 0 6px 16px rgba(28,20,12,0.12);
}
.modal-close:focus { outline: 3px solid rgba(184,107,28,0.14); }

/* modal content uses a warm serif to feel like a card */
.modal-content { font-family: 'Georgia', 'Times New Roman', serif; }

/* screen-reader-only utility */
.sr-only {
  position: absolute !important;
  width: 1px; height: 1px;
  padding: 0; margin: -1px; overflow: hidden; clip: rect(0 0 0 0);
  white-space: nowrap; border: 0;
}

/* Favorite modal image transition and focus styles */
.fav-modal .fav-modal-image, .fav-modal-image { transition: transform 240ms ease, opacity 240ms ease; }
.fav-modal .fav-modal-image:hover { transform: scale(1.02); }
.fav-item.focused { outline: 2px solid rgba(0,0,0,0.08); }

.theme-night .card:hover {
  background: rgba(255,255,255,0.04);
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.hover-name {
  text-decoration: underline;
  cursor: pointer;
  position: relative;
}

.hover-image {
  position: absolute;
  top: -160px;
  left: 0;
  width: 140px;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

/* When hover-images appear inside savor-mode lines, position them higher and animate smoothly
   so they don't push layout or overlap awkwardly. Use transform/opacity for GPU-accelerated animation. */
.savor-line { position: relative; }
.savor-line .hover-image {
  top: -140px; /* slightly closer to the line */
  left: auto;  /* position relative to the inline word */
  right: 0;    /* anchor to the end of the inline span */
  width: 140px;
  pointer-events: none; /* avoid interfering with hover interactions on the text */
  opacity: 0;
  transform: translateY(6px) scale(0.98);
  transition: opacity 240ms ease, transform 240ms ease;
}
.savor-line .hover-name:hover .hover-image,
.savor-line .hover-name:focus .hover-image,
.savor-line .hover-name[aria-expanded="true"] .hover-image {
  opacity: 1;
  transform: translateY(0) scale(1);
  pointer-events: auto; /* allow clicks if necessary when visible */
}

.secret {
  margin-top: 80px;
  text-align: center;
  opacity: 0.6;
}

/* secret image reveal styles */
.secret-image-wrapper {
  position: relative;
  display: inline-block;
  opacity: 0;
  transform: scale(0.98);
  transition: opacity 320ms ease, transform 320ms ease;
}
.secret-image-wrapper.visible { opacity: 1; transform: scale(1); }
.secret-image-wrapper img { border-radius: 8px; box-shadow: 0 8px 30px rgba(0,0,0,0.18); }
.secret-close { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.6); color: #fff; border: none; width: 36px; height: 36px; border-radius: 8px; cursor: pointer; }

/* persona alignment helpers */
.persona-align-controls { position: fixed; left: 12px; top: 12px; z-index: 9999; display: flex; gap: 8px; }
.persona-align-controls button { padding: 6px 8px; border-radius: 6px; border: none; background: rgba(0,0,0,0.6); color: #fff; cursor: pointer; }
.persona-align-left { background-position: left center !important; }
.persona-align-center { background-position: center center !important; }
.persona-align-right { background-position: right center !important; }

/* Persona background layer */
.app-root { position: relative; z-index: 0; isolation: isolate; }
.persona-layer { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; /* fallback background if img doesn't load */
  /* first layer: image if present, second: earthy gradient fallback */
  background-image: url('/images/luna.JPG'), var(--earth-gradient);
  background-repeat: no-repeat, no-repeat;
  background-position: center right, center;
  /* show the full persona image (contain) but keep the gradient fallback covering */
  --persona-bg-size: contain;
  background-size: var(--persona-bg-size), cover;
  background-attachment: fixed; /* keep background fixed while content changes */
}
/* hide floating <img> to avoid the large centered blurred block; use background-image for landscape effect */
.persona-layer .persona { display: none; }
.content { position: relative; z-index: 3; background: transparent; }
.content::before {
  content: "";
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  top: 0;
  width: min(920px, 92%);
  height: 100%;
  /* gentle left-to-right gradient: more opaque near text, transparent toward the portrait */
  background: linear-gradient(90deg,
    rgba(255,255,255,0.42) 0%,
    rgba(255,255,255,0.18) 30%,
    rgba(255,255,255,0.06) 55%,
    transparent 100%);
  pointer-events: none;
  /* soften backdrop blur so it doesn't wash the photo */
  backdrop-filter: blur(2px);
  z-index: 2;
  border-radius: 14px;
}

/* night theme: use a dark-to-transparent gradient */
.theme-night .content::before {
  background: linear-gradient(90deg,
    rgba(8,8,8,0.42) 0%,
    rgba(8,8,8,0.18) 30%,
    rgba(8,8,8,0.06) 55%,
    transparent 100%);
}

/* ensure content children sit above the overlay */
.content > * { position: relative; z-index: 3; }
.persona-hidden .persona { opacity: 0 !important; transform: scale(1) !important; }

/* Persona beautification overlays */
.persona-layer { --persona-translate: 0px; }
.persona-layer .persona {
  position: absolute;
  transform: translateY(var(--persona-translate)) scale(var(--persona-scale));
  transition: transform 520ms ease;
  opacity: calc(var(--persona-opacity) * 0.98);
  z-index: 6; /* ensure persona sits above sketch/floral overlays */
  pointer-events: none;
}
.persona-layer .persona-overlay {
  position: absolute; inset: 0; z-index: 1; pointer-events: none;
  background: linear-gradient(120deg, rgba(255,235,210,0.12), rgba(255,245,235,0.06));
  mix-blend-mode: multiply;
}
.persona-layer .persona-vignette {
  position: absolute; inset: 0; z-index: 3; pointer-events: none;
  background: radial-gradient(60% 60% at 70% 40%, rgba(0,0,0,0) 0%, rgba(0,0,0,0.14) 60%, rgba(0,0,0,0.28) 100%);
}
/* fine grain texture using a semi-transparent PNG or CSS noise fallback */
.persona-layer .persona-grain {
  position: absolute; inset: 0; z-index: 4; pointer-events: none;
  /* CSS noise fallback (subtle), avoids requiring an external grain image */
  background-image: linear-gradient(transparent 0%, rgba(255,255,255,0.01) 50%, transparent 100%),
                    radial-gradient(rgba(0,0,0,0.02) 1px, transparent 1px);
  background-size: 100% 100%, 3px 3px;
  opacity: 0.04;
  mix-blend-mode: overlay;
}

/* Decorative thumbnail grid shown on the right side of the persona area */
.persona-layer .persona-grid {
  position: absolute;
  right: 6vw;
  top: 18vh;
  width: 220px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  z-index: 5;
  pointer-events: none; /* decorative only */
}
.persona-layer .persona-grid img {
  width: 100%;
  height: 120px;
  object-fit: cover;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
  opacity: 0.98;
  transform: translateY(0);
}

@media (max-width: 900px) {
  .persona-layer .persona-grid { display: none; }
}

/* persona-pattern removed: decorative patterns and sketch/floral overlays were removed from the UI */

/* persona-sketch removed: sketch/graphite decorative overlays are disabled */

/* persona-sketch-image removed: floral overlays are disabled */

/* make the pattern slightly stronger on larger screens */
@media (min-width: 900px) {
  .persona-layer .persona-pattern { opacity: 0.08; background-size: 36px 36px, 72px 72px; }
}

/* Pattern variants */
:root { --pattern-foreground: rgba(255,255,255,0.04); --pattern-foreground-2: rgba(0,0,0,0.01); }
.theme-night { --pattern-foreground: rgba(255,255,255,0.02); --pattern-foreground-2: rgba(0,0,0,0.06); }

.persona-layer.pattern-dots .persona-pattern {
  background-image:
    radial-gradient(circle at 10% 10%, var(--pattern-foreground) 2px, transparent 2px),
    radial-gradient(circle at 40% 40%, var(--pattern-foreground-2) 1px, transparent 1px);
  background-size: 24px 24px, 48px 48px;
}

.persona-layer.pattern-waves .persona-pattern {
  background-image:
    repeating-linear-gradient(135deg, var(--pattern-foreground) 0 6px, transparent 6px 18px),
    linear-gradient(180deg, transparent, rgba(0,0,0,0.02));
  background-size: 40px 40px, 100% 100%;
}

.persona-layer.pattern-floral .persona-pattern {
  /* stylized floral motif using layered gradients */
  background-image:
    radial-gradient(circle at 20% 30%, var(--pattern-foreground) 4px, transparent 6px),
    radial-gradient(circle at 70% 70%, var(--pattern-foreground-2) 3px, transparent 6px),
    linear-gradient(135deg, rgba(255,255,240,0.01), transparent 60%);
  background-size: 60px 60px, 90px 90px, 100% 100%;
}

/* make overlays slightly more subtle in night theme */
.theme-night .persona-layer .persona-overlay { opacity: 0.06; }
.theme-night .persona-layer .persona-vignette { background: radial-gradient(60% 60% at 70% 40%, rgba(0,0,0,0) 0%, rgba(0,0,0,0.22) 60%, rgba(0,0,0,0.44) 100%); }

@media (max-width: 800px) {
  .persona-layer .persona { width: 120vw; right: -20%; top: 4%; opacity: calc(var(--persona-opacity) * 0.95); filter: blur(calc(var(--persona-blur) * 0.9)); }
  /* on small screens, show the image a bit larger so it's still visible but contained */
  .persona-layer { --persona-bg-size: 140% auto; }
}

/* Sound player tweaks */
.sound-player button { background: rgba(0,0,0,0.6); color: #fff; border: none; padding: 6px 10px; border-radius: 8px; }
.sound-player input[type=range] { width: 80px; }
